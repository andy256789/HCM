<div class="reports-container">
  <!-- Page Header -->
  <div class="page-header">
    <h2 class="page-title">HR Analytics & Reports</h2>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="refreshData()" class="refresh-button">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
      <button mat-stroked-button (click)="exportReport()" class="export-button">
        <mat-icon>download</mat-icon>
        Export
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
  </div>

  <div class="reports-content" *ngIf="!loading">
    <!-- Key Metrics Overview -->
    <div class="metrics-section">
      <h2 class="section-title">
        <mat-icon>dashboard</mat-icon>
        Key Metrics Overview
      </h2>
      
      <div class="metrics-grid">
        <mat-card class="metric-card">
          <mat-card-content>
            <div class="metric-header">
              <mat-icon class="metric-icon employees">people</mat-icon>
              <span class="metric-label">Total Employees</span>
            </div>
            <div class="metric-value">{{ totalEmployees }}</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="metric-card">
          <mat-card-content>
            <div class="metric-header">
              <mat-icon class="metric-icon departments">business</mat-icon>
              <span class="metric-label">Departments</span>
            </div>
            <div class="metric-value">{{ totalDepartments }}</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="metric-card">
          <mat-card-content>
            <div class="metric-header">
              <mat-icon class="metric-icon payroll">attach_money</mat-icon>
              <span class="metric-label">Total Payroll</span>
            </div>
            <div class="metric-value">${{ totalPayroll | number:'1.0-0' }}</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="metric-card">
          <mat-card-content>
            <div class="metric-header">
              <mat-icon class="metric-icon average">trending_up</mat-icon>
              <span class="metric-label">Average Salary</span>
            </div>
            <div class="metric-value">${{ averageSalary | number:'1.0-0' }}</div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Salary Analysis -->
    <div class="analysis-section">
      <h2 class="section-title">
        <mat-icon>bar_chart</mat-icon>
        Salary Analysis
      </h2>

      <div class="analysis-grid">
        <!-- Salary Ranges -->
        <mat-card class="analysis-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>pie_chart</mat-icon>
              Salary Distribution
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="salary-ranges">
              <div class="range-item" *ngFor="let range of salaryRanges">
                <div class="range-info">
                  <span class="range-label">{{ range.range }}</span>
                  <span class="range-count">{{ range.count }} employees</span>
                </div>
                <div class="range-bar">
                  <div class="range-fill" [style.width.%]="range.percentage"></div>
                </div>
                <span class="range-percentage">{{ range.percentage | number:'1.1-1' }}%</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Top Performers -->
        <mat-card class="analysis-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>star</mat-icon>
              Highest Paid Employees
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="top-performers">
              <div class="performer-item" *ngFor="let employee of getTopPerformers(); let i = index">
                <div class="performer-rank">{{ i + 1 }}</div>
                <div class="performer-info">
                  <div class="performer-name">{{ employee.fullName }}</div>
                  <div class="performer-title">{{ employee.jobTitle }}</div>
                  <div class="performer-dept">{{ employee.departmentName }}</div>
                </div>
                <div class="performer-salary">${{ employee.salary | number:'1.2-2' }}</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Salary Extremes -->
      <div class="extremes-grid">
        <mat-card class="extreme-card highest" *ngIf="highestPaidEmployee">
          <mat-card-content>
            <div class="extreme-header">
              <mat-icon>trending_up</mat-icon>
              <span>Highest Paid Employee</span>
            </div>
            <div class="extreme-employee">
              <div class="employee-name">{{ highestPaidEmployee.fullName }}</div>
              <div class="employee-details">
                <span class="job-title">{{ highestPaidEmployee.jobTitle }}</span>
                <span class="department">{{ highestPaidEmployee.departmentName }}</span>
              </div>
              <div class="salary-amount">${{ highestPaidEmployee.salary | number:'1.2-2' }}</div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="extreme-card lowest" *ngIf="lowestPaidEmployee">
          <mat-card-content>
            <div class="extreme-header">
              <mat-icon>trending_down</mat-icon>
              <span>Lowest Paid Employee</span>
            </div>
            <div class="extreme-employee">
              <div class="employee-name">{{ lowestPaidEmployee.fullName }}</div>
              <div class="employee-details">
                <span class="job-title">{{ lowestPaidEmployee.jobTitle }}</span>
                <span class="department">{{ lowestPaidEmployee.departmentName }}</span>
              </div>
              <div class="salary-amount">${{ lowestPaidEmployee.salary | number:'1.2-2' }}</div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Department Analysis -->
    <div class="department-section">
      <h2 class="section-title">
        <mat-icon>business</mat-icon>
        Department Analysis
      </h2>

      <div class="department-grid">
        <mat-card class="department-card" *ngFor="let summary of departmentSummaries">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>business_center</mat-icon>
              {{ summary.department.name }}
            </mat-card-title>
            <mat-card-subtitle *ngIf="summary.department.description">
              {{ summary.department.description }}
            </mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <div class="department-metrics">
              <div class="dept-metric">
                <mat-icon>people</mat-icon>
                <div class="metric-info">
                  <span class="metric-value">{{ summary.employeeCount }}</span>
                  <span class="metric-label">Employees</span>
                </div>
              </div>
              
              <mat-divider></mat-divider>
              
              <div class="dept-metric">
                <mat-icon>attach_money</mat-icon>
                <div class="metric-info">
                  <span class="metric-value">${{ summary.totalSalary | number:'1.0-0' }}</span>
                  <span class="metric-label">Total Payroll</span>
                </div>
              </div>
              
              <mat-divider></mat-divider>
              
              <div class="dept-metric">
                <mat-icon>trending_up</mat-icon>
                <div class="metric-info">
                  <span class="metric-value">${{ summary.averageSalary | number:'1.0-0' }}</span>
                  <span class="metric-label">Average Salary</span>
                </div>
              </div>
            </div>

            <div class="department-employees" *ngIf="summary.employeeCount > 0">
              <h4>Team Members</h4>
              <mat-chip-set>
                <mat-chip *ngFor="let employee of summary.employees">
                  {{ employee.fullName }}
                </mat-chip>
              </mat-chip-set>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Department Insights -->
    <div class="insights-section">
      <h2 class="section-title">
        <mat-icon>insights</mat-icon>
        Department Insights
      </h2>

      <div class="insights-grid">
        <mat-card class="insight-card" *ngIf="getDepartmentWithMostEmployees() as largestDept">
          <mat-card-content>
            <div class="insight-header">
              <mat-icon class="insight-icon">group</mat-icon>
              <span class="insight-title">Largest Department</span>
            </div>
            <div class="insight-content">
              <div class="insight-value">{{ largestDept.department.name }}</div>
              <div class="insight-description">
                {{ largestDept.employeeCount }} employees
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="insight-card" *ngIf="getDepartmentWithHighestPayroll() as highestPayroll">
          <mat-card-content>
            <div class="insight-header">
              <mat-icon class="insight-icon">monetization_on</mat-icon>
              <span class="insight-title">Highest Payroll</span>
            </div>
            <div class="insight-content">
              <div class="insight-value">{{ highestPayroll.department.name }}</div>
              <div class="insight-description">
                ${{ highestPayroll.totalSalary | number:'1.0-0' }} total
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="totalEmployees === 0">
      <mat-icon class="empty-icon">analytics</mat-icon>
      <h3>No Data Available</h3>
      <p>Add employees and departments to see analytics and reports.</p>
    </div>
  </div>
</div>
